# RAG (Retrieval-Augmented Generation)

ì¶œì²˜: ê°œë°œì ìœ ë¯¸ - YouTube

í•™ìŠµ ê¸°ê°„: 2025/03/26 ~ 2025/03/30

---

### ğŸ“Œ RAGë€?

RAG(Retrieval-Augmented Generation)ëŠ” LLM(Large Language Model)ì´ ë‹µë³€ì„ ìƒì„±í•˜ê¸° ì „ì— ì™¸ë¶€ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ì—¬ ë³´ë‹¤ ì •í™•í•œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‘ë‹µí•˜ëŠ” ê¸°ìˆ 

ì´ë¥¼ í†µí•´ íŠ¹ì • ë„ë©”ì¸ì˜ êµ¬ì²´ì ì¸ ë‚´ìš©ì„ ë°˜ì˜í•œ ë”ìš± ì •ë°€í•œ ë‹µë³€ì„ ê¸°ëŒ€í•  ìˆ˜ ìˆë‹¤.

---

### ğŸ› ï¸ ë™ì‘ ë°©ì‹

1. ì‚¬ìš©ìê°€ LLMì—ê²Œ ì§ˆë¬¸ì„ ì…ë ¥í•œë‹¤.

2. ê´€ë ¨ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ì—¬ ì„ ë³„í•œë‹¤.

3. ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ í”„ë¡¬í”„íŠ¸ì— ì¶”ê°€í•˜ì—¬ LLMì—ê²Œ ì§ˆë¬¸ì„ ì „ë‹¬í•œë‹¤.

4. LLMì€ ê²€ìƒ‰ëœ ë¬¸ì„œì™€ ìì²´ ì¶”ë¡  ëŠ¥ë ¥ì„ ê²°í•©í•˜ì—¬ ìµœì¢… ë‹µë³€ì„ ìƒì„±í•œë‹¤. 

---

### ğŸ” ê²€ìƒ‰ ì‹œìŠ¤í…œ

RAGì—ì„œëŠ” ë¬¸ì„œ ê²€ìƒ‰ì„ ìœ„í•´ Elasticsearchë¥¼ í™œìš©í•  ìˆ˜ ìˆìœ¼ë©° ì‚¬ìš©ìì˜ ì§ˆë¬¸ê³¼ ìœ ì‚¬í•œ ë¬¸ì„œë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆë‹¤.

ğŸ”¹ Sparse ê²€ìƒ‰

í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ ë°©ì‹

í˜•íƒœì†Œ ë¶„ì„ê¸°(ë‹¨ì–´ë¥¼ ë¶„ì„í•˜ëŠ” ë„êµ¬)ì™€ í•„í„°(ë¶ˆí•„ìš”í•œ ë‹¨ì–´ë¥¼ ê±¸ë ¤ì£¼ëŠ” ê¸°ëŠ¥)ë¥¼ í™œìš©í•˜ì—¬ ê²€ìƒ‰ ì •í™•ë„ë¥¼ í–¥ìƒ

í•œê¸€ í˜•íƒœì†Œ ë¶„ì„ê¸°ë¡œ Norië¥¼ ì‚¬ìš©

ê° í‚¤ì›Œë“œì— ëŒ€í•´ ì¸ë±ì‹± ìˆ˜í–‰ í›„ ê²€ìƒ‰ ì§„í–‰

ğŸ”¹ Sparse í™œìš© RAG ì ˆì°¨ 

1. ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë°›ëŠ”ë‹¤.

2. Elasticsearchì—ì„œ ìš”ì²­ê³¼ ìœ ì‚¬í•œ í‚¤ì›Œë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê²°ê³¼ nê°œë¥¼ ê²€ìƒ‰í•œë‹¤.

3. ê²°ê³¼ nê°œë¥¼ LLMì—ê²Œ ì „ì†¡í•œë‹¤.

4. LLMì€ í•´ë‹¹ ê²°ê³¼ë¥¼ í†µí•´ ìµœì í™”ëœ ì‘ë‹µì„ ìƒì„±í•œë‹¤. 

=> Elasticsearch ì¸ë±ìŠ¤ ë§¤í•‘
```
{
  "settings": { 
    "analysis": { # í…ìŠ¤íŠ¸ë¥¼ ì–´ë–»ê²Œ ë¶„ë¦¬í•  ê²ƒì¸ì§€ 
      "tokenizer": { # í† í°í™”(ë‹¨ì–´ ë¶„ë¦¬)
        "nori_tokenizer_my": { 
          "type": "nori_tokenizer", # Nori í˜•íƒœì†Œ ë¶„ì„ê¸°ë¥¼ ì‚¬ìš©í•´ í•œêµ­ì–´ ë¬¸ì¥ì„ ë‹¨ì–´ ë‹¨ìœ„ë¡œ ë¶„í•´ 
          "decompound_mode": "mixed", # ë³µí•©ì–´ë¥¼ ë‹¨ì–´ë¡œ ë¶„ë¦¬  
          "discard_punctuation": "false", # êµ¬ë‘ì ì„ ë²„ë¦¬ì§€ ì•Šê²Œ ì„¤ì • 
          "lenient": true # ë¶„ì„ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬ 
        }
      },
      "analyzer": { # ë¶„ì„ê¸° ì§€ì • ë° í•„í„° ì ìš© 
        "nori_analyzer": {
          "type": "custom", # ì‚¬ìš©ì ì •ì˜ ë¶„ì„ê¸°ë¥¼ ì •ì˜
          "tokenizer": "nori_tokenizer_my", 
          "filter": ["lowercase"] # ëª¨ë“  ë‹¨ì–´ë¥¼ ì†Œë¬¸ìë¡œ ë³€í™˜í•´ ê²€ìƒ‰ ì¼ê´€ì„± ìœ ì§€ 
        }
      }
    }
  },
  "mappings": { # ë¬¸ì„œë¥¼ ì €ì¥í•  ë•Œ ë°ì´í„°ì˜ íƒ€ì…ê³¼ ë¶„ì„ ë°©ë²•ì„ ì •ì˜ 
    "properties": { 
      "Question": {
        "type": "text",
        "analyzer": "nori_analyzer" # Question í•„ë“œëŠ” nori_analyzer ë¶„ì„ê¸°ë¡œ ì²˜ë¦¬
      },
      "Answer": {
        "type": "text"
        "index" : false # ë‹µë³€ í•„ë“œëŠ” ê²€ìƒ‰ ëŒ€ìƒì—ì„œ ì œì™¸ëœë‹¤ why ? ë‹µë³€ì—ë„ ì¸ë±ìŠ¤ê°€ ìƒì„±ë˜ë©´ ë¶ˆí•„ìš”í•œ ë°ì´í„°ê°€ ë§ì•„ì ¸ ê²€ìƒ‰ ì†ë„ê°€ ëŠë ¤ì§ 
      }
    }
  }
}
```

ğŸ”¹ Dense ê²€ìƒ‰

ì„ë² ë”© ë²¡í„° ê¸°ë°˜ ê²€ìƒ‰ ë°©ì‹ (ì„ë² ë”© : ë‹¨ì–´, ë¬¸ì¥, ì´ë¯¸ì§€ ê°™ì€ í…ìŠ¤íŠ¸ë¥¼ ìˆ«ìë¡œ ë³€í™˜í•˜ëŠ” ê¸°ìˆ )

í…ìŠ¤íŠ¸ë¥¼ ë²¡í„°(ìˆ«ìì˜ ì§‘í•©)ë¡œ ë³€í™˜í•œ í›„ ë²¡í„° ê°„ì˜ ìœ ì‚¬ë„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ë°©ì‹ 

ğŸ”¹ Dense í™œìš© RAG ì ˆì°¨ 

1. ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë°›ëŠ”ë‹¤.

2. ì‚¬ìš©ìì˜ ìš”ì²­ì„ ì„ë² ë”© ëª¨ë¸ì„ í†µí•´ ë²¡í„°í™” ì‹œí‚¨ë‹¤.

3. Elasticsearchì—ì„œ ìš”ì²­ê³¼ ìœ ì‚¬í•œ ë²¡í„°ë¥¼ ê²€ìƒ‰í•œë‹¤.

4. ê²°ê³¼ nê°œë¥¼ LLMì—ê²Œ ì „ì†¡í•œë‹¤.

5. LLMì€ í•´ë‹¹ ê²°ê³¼ë¥¼ í†µí•´ ìµœì í™”ëœ ì‘ë‹µì„ ìƒì„±í•œë‹¤. 

=> Elasticsearch ì¸ë±ìŠ¤ ë§¤í•‘
```
{
  "mappings": { => ë¬¸ì„œë¥¼ ì €ì¥í•  ë•Œ ê° í•„ë“œì˜ íƒ€ì…ê³¼ ë¶„ì„ ë°©ë²•ì„ ì •ì˜
    "properties": {
      "Vector": { 
       "type": "dense_vector", =>ë°€ì§‘ ë²¡í„°(dense_vector) : ë”¥ëŸ¬ë‹ ê¸°ë°˜ì˜ ìœ ì‚¬ë„ ê²€ìƒ‰ ì§„í–‰
       "dims": 1536,
=>ë²¡í„°ì˜ ì°¨ì› ìˆ˜(OpenAI text-embedding-3-small ëª¨ë¸ì€ 1536ì°¨ì› ë²¡í„°ë¥¼ ìƒì„±)
       "index": true, => Vector ë°ì´í„° ì¸ë±ì‹± ì§„í–‰
       "similarity": "l2_norm" => ë²¡í„° ê°„ ìœ ì‚¬ë„ ì¸¡ì • ë°©ì‹ (L2 Norm, ìœ í´ë¦¬ë“œ ê±°ë¦¬)
      },
      "Question": { => ê²€ìƒ‰ ì‹œ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
        "type": "text",
        "index": false
      },
      "Answer": { => ê²€ìƒ‰ ì‹œ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
        "type": "text",
        "index": false
      }
    }
  }
}
```

--- 

ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
RAG-Practice
|-- Dense
  |-- dense_insert_elastic.py # JSON ë°ì´í„°ë¥¼ Elasticsearchì— ì¸ë±ì‹±í•˜ì—¬ ì €ì¥
  |-- dense_rag_api.py # Dense ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ LLM(GPT)ë¥¼ í™œìš©í•œ ì‘ë‹µ ìƒì„±
  |-- embeddingcall.py # OpenAIì—ê²Œ ìš”ì²­ë¬¸ì„ ë³´ë‚´ ìˆ«ì ë²¡í„°ë¡œ ë³€í™˜
  |-- textTovec.py # ë°ì´í„° ì…‹ JSON íŒŒì¼ì„ ë²¡í„°í™” ì‹œì¼œ JSON íŒŒì¼ ìƒì„±
|-- Sparse
  â”‚-- sparse_insert_elastic.py # JSON ë°ì´í„°ë¥¼ Elasticsearchì— ì¸ë±ì‹±í•˜ì—¬ ì €ì¥
  â”‚-- sparse_rag_api.py # Sparse ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ LLM(GPT)ë¥¼ í™œìš©í•œ ì‘ë‹µ ìƒì„±
devyummi_qna.json # Q&A êµ¬ì¡°ì˜ JSON íŒŒì¼
devyummi_qna_vector.json # Questionì„ ë²¡í„°í™” ì‹œí‚¨ JSON íŒŒì¼
llm_api.py # ê¸°ë³¸ LLM ì‘ë‹µ ìƒ
```

---

ğŸš€ ìš´ì˜ í™˜ê²½ ë° API

- ë¡œì»¬ í™˜ê²½ : Python 3.13.2, Visual Studio Code

- Elasticsearch í™˜ê²½ : WSL2 (Ubuntu 20.04)

- API : Chat-GPT(gpt-4o-mini)

ElasticsearchëŠ” ë¦¬ëˆ…ìŠ¤ í™˜ê²½ì—ì„œ ì„¤ì¹˜ ë° ì‹¤í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— Window í™˜ê²½ì—ì„œ PowerShell 7ì„ ì´ìš©í•˜ì—¬ WSL2ì„ ì„¤ì¹˜í•œ í›„ Ubuntu 20.04 í™˜ê²½ì—ì„œ í•™ìŠµí•˜ì˜€ìŠµë‹ˆë‹¤. 




  
   
